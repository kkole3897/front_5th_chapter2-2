var $=Object.defineProperty;var q=(s,t,n)=>t in s?$(s,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[t]=n;var N=(s,t,n)=>q(s,typeof t!="symbol"?t+"":t,n);import{j as e,r as g,f as F,u as I,d as D,e as R,c as M,h as V,i as L,b as U,R as O}from"./cart-b_q57JV7.js";const f=class f extends Error{constructor(t){const n=Object.keys(t),d=`A product must have the following properties: ${B.filter(i=>!n.includes(i)).join(", ")}`;super(d),this.createProductProperties=t,this.name=f.NAME}};N(f,"NAME","MissingRequiredProductPropertyError");let k=f;const w=class w extends Error{constructor(t){const n=`The product name "${t}" is invalid.`;super(n),this.productName=t,this.name=w.NAME}};N(w,"NAME","InvalidProductNameError");let P=w;const y=class y extends Error{constructor(t){const n=`The product name "${t}" is already in use.`;super(n),this.productName=t,this.name=y.NAME}};N(y,"NAME","DuplicatedProductNameError");let E=y;const C=class C extends Error{constructor(t){super(`${t.name} is out of stock`),this.name=C.name}};N(C,"name","OutOfStockError");let T=C;const B=["name","price","stock"],Q=(s,t)=>{if(!J(t))throw new k(t);if(!W(t.name))throw new P(t.name);if(!z(s,t.name))throw new E(t.name);const n={id:`p${s.length+1}`,discounts:[],...t};return[...s,n]};function J(s){const{name:t,price:n,stock:l}=s;return!(t===void 0||n===void 0||l===void 0)}function W(s){return s.length>0}function z(s,t){return!s.find(l=>l.name===t)}const G=(s,t)=>s.map(n=>n.id===t.id?t:n),H=({coupon:s,index:t})=>e.jsxs("div",{"data-testid":`coupon-${t+1}`,className:"bg-gray-100 p-2 rounded",children:[s.name," (",s.code,"):",s.discountType==="amount"?`${s.discountValue}원`:`${s.discountValue}%`," ","할인"]}),K=({onCreate:s})=>{const[t,n]=g.useState({name:"",code:"",discountType:"percentage",discountValue:0}),l=()=>{s(t),n({name:"",code:"",discountType:"percentage",discountValue:0})};return e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"쿠폰 이름",value:t.name,onChange:d=>n({...t,name:d.target.value}),className:"w-full p-2 border rounded"}),e.jsx("input",{type:"text",placeholder:"쿠폰 코드",value:t.code,onChange:d=>n({...t,code:d.target.value}),className:"w-full p-2 border rounded"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:t.discountType,onChange:d=>n({...t,discountType:d.target.value}),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"amount",children:"금액(원)"}),e.jsx("option",{value:"percentage",children:"할인율(%)"})]}),e.jsx("input",{type:"number",placeholder:"할인 값",value:t.discountValue,onChange:d=>n({...t,discountValue:parseInt(d.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:l,className:"w-full bg-green-500 text-white p-2 rounded hover:bg-green-600",children:"쿠폰 추가"})]})},X=s=>{const[t,n]=g.useState(s);return{coupons:t,addCoupon:d=>{n([...t,d])}}},Y=()=>{const[s,t]=g.useState([]),[n,l]=g.useState(null);return{cart:s,addToCart:a=>{if(a.stock<=0)throw new T(a);const m=F(s,a.id);if(m){t(b=>I(b,a.id,m.quantity+1));return}t(b=>D(b,a))},removeFromCart:a=>{t(m=>R(m,a))},updateQuantity:(a,m)=>{t(b=>I(b,a,m))},applyCoupon:a=>{l(a)},calculateTotal:()=>M(s,n),selectedCoupon:n}},Z=({products:s,coupons:t})=>{const{cart:n,addToCart:l,removeFromCart:d,updateQuantity:i,applyCoupon:c,calculateTotal:h,selectedCoupon:u}=Y(),a=o=>o.reduce((x,r)=>Math.max(x,r.rate),0),m=o=>{const x=n.find(r=>r.product.id===o.id);return o.stock-((x==null?void 0:x.quantity)||0)},{totalBeforeDiscount:b,totalAfterDiscount:S,totalDiscount:j}=h(),v=o=>{const{discounts:x}=o.product,{quantity:r}=o;let p=0;for(const A of x)r>=A.quantity&&(p=Math.max(p,A.rate));return p};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"장바구니"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 목록"}),e.jsx("div",{className:"space-y-2",children:s.map(o=>{const x=m(o);return e.jsxs("div",{"data-testid":`product-${o.id}`,className:"bg-white p-3 rounded shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-semibold",children:o.name}),e.jsxs("span",{className:"text-gray-600",children:[o.price.toLocaleString(),"원"]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[e.jsxs("span",{className:`font-medium ${x>0?"text-green-600":"text-red-600"}`,children:["재고: ",x,"개"]}),o.discounts.length>0&&e.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:["최대"," ",(a(o.discounts)*100).toFixed(0),"% 할인"]})]}),o.discounts.length>0&&e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:o.discounts.map((r,p)=>e.jsxs("li",{children:[r.quantity,"개 이상:"," ",(r.rate*100).toFixed(0),"% 할인"]},p))}),e.jsx("button",{onClick:()=>l(o),className:`w-full px-3 py-1 rounded ${x>0?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,disabled:x<=0,children:x>0?"장바구니에 추가":"품절"})]},o.id)})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"장바구니 내역"}),e.jsx("div",{className:"space-y-2",children:n.map(o=>{const x=v(o);return e.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded shadow",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:o.product.name}),e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-600",children:[o.product.price,"원 x ",o.quantity,x>0&&e.jsxs("span",{className:"text-green-600 ml-1",children:["(",(x*100).toFixed(0),"% 할인 적용)"]})]})]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>i(o.product.id,o.quantity-1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"-"}),e.jsx("button",{onClick:()=>i(o.product.id,o.quantity+1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"+"}),e.jsx("button",{onClick:()=>d(o.product.id),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]})]},o.product.id)})}),e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"쿠폰 적용"}),e.jsxs("select",{onChange:o=>c(t[parseInt(o.target.value)]),className:"w-full p-2 border rounded mb-2",children:[e.jsx("option",{value:"",children:"쿠폰 선택"}),t.map((o,x)=>e.jsxs("option",{value:x,children:[o.name," -"," ",o.discountType==="amount"?`${o.discountValue}원`:`${o.discountValue}%`]},o.code))]}),u&&e.jsxs("p",{className:"text-green-600",children:["적용된 쿠폰: ",u.name,"(",u.discountType==="amount"?`${u.discountValue}원`:`${u.discountValue}%`," ","할인)"]})]}),e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"주문 요약"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:["상품 금액: ",b.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-green-600",children:["할인 금액: ",j.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",S.toLocaleString(),"원"]})]})]})]})]})]})},_=(s,t)=>{const n=g.useCallback(()=>{try{const a=localStorage.getItem(s);return a?JSON.parse(a):t}catch{return console.warn(`Error getting value from localStorage for key: ${s}`),t}},[s,t]),[l,d]=g.useState(()=>n()),i=a=>{const m=a instanceof Function?a(l):a;d(a),localStorage.setItem(s,JSON.stringify(m)),window.dispatchEvent(new StorageEvent("localStorageChange",{key:s}))},c=()=>{localStorage.removeItem(s),d(t),window.dispatchEvent(new StorageEvent("localStorageChange",{key:s}))};g.useEffect(()=>{d(n())},[s]);const h=g.useCallback(a=>{if(a.key===s){const m=localStorage.getItem(s),b=m?JSON.parse(m):t;d(b)}},[s,t]),u=g.useCallback(a=>{a.key===s&&d(n())},[s,n]);return g.useEffect(()=>(window.addEventListener("storage",h),()=>{window.removeEventListener("storage",h)}),[h]),g.useEffect(()=>(window.addEventListener("localStorageChange",u),()=>{window.removeEventListener("localStorageChange",u)}),[u]),[l,i,c]},ee=s=>{const[t,n]=_("products",s);return{products:t,updateProduct:i=>{n(c=>G(c,i))},addProduct:i=>{n(c=>Q(c,i))}}},te=({onCreate:s})=>{const[t,n]=g.useState({name:"",price:0,stock:0}),l=i=>{const{name:c,value:h}=i.target,u={name:a=>a,price:a=>parseInt(a),stock:a=>parseInt(a)};n({...t,[c]:u[c](h)})},d=()=>{s==null||s(t),n({name:"",price:0,stock:0})};return e.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productName",className:"block text-sm font-medium text-gray-700",children:"상품명"}),e.jsx("input",{id:"productName",type:"text",name:"name",value:t.name,onChange:l,className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productPrice",className:"block text-sm font-medium text-gray-700",children:"가격"}),e.jsx("input",{id:"productPrice",type:"number",name:"price",value:t.price,onChange:l,className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productStock",className:"block text-sm font-medium text-gray-700",children:"재고"}),e.jsx("input",{id:"productStock",type:"number",name:"stock",value:t.stock,onChange:l,className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:d,className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"추가"})]})},se=({product:s,index:t,onChange:n})=>{const[l,d]=g.useState(!1),i=()=>{d(r=>!r)},[c,h]=g.useState(null),u=()=>{h(s)},a=r=>{if(!c)return;const p={...c,name:r.target.value};h(p)},m=r=>{if(!c)return;const p={...c,price:parseInt(r.target.value)};h(p)},b=r=>{if(!c)return;const p={...c,stock:parseInt(r.target.value)};h(p)},S=r=>{if(!c)return;const p={...c,discounts:V(c.discounts,r)};h(p),n(c)},[j,v]=g.useState({quantity:0,rate:0}),o=()=>{if(!c)return;const r={...c,discounts:L(c.discounts,j)};h(r),n(r),v({quantity:0,rate:0})},x=()=>{c&&(n(c),h(null))};return e.jsxs("div",{"data-testid":`product-${t+1}`,className:"bg-white p-4 rounded shadow",children:[e.jsxs("button",{"data-testid":"toggle-button",onClick:i,className:"w-full text-left font-semibold",children:[s.name," - ",s.price,"원 (재고: ",s.stock,")"]}),l&&e.jsx("div",{className:"mt-2",children:c?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"상품명: "}),e.jsx("input",{type:"text",value:c.name,onChange:a,className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"가격: "}),e.jsx("input",{type:"number",value:c.price,onChange:m,className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"재고: "}),e.jsx("input",{type:"number",value:c.stock,onChange:b,className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),c.discounts.map((r,p)=>e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{children:[r.quantity,"개 이상 구매 시 ",r.rate*100,"% 할인"]}),e.jsx("button",{onClick:()=>S(p),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]},p)),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"number",placeholder:"수량",value:j.quantity,onChange:r=>v({...j,quantity:parseInt(r.target.value)}),className:"w-1/3 p-2 border rounded"}),e.jsx("input",{type:"number",placeholder:"할인율 (%)",value:j.rate*100,onChange:r=>v({...j,rate:parseInt(r.target.value)/100}),className:"w-1/3 p-2 border rounded"}),e.jsx("button",{onClick:o,className:"w-1/3 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"할인 추가"})]})]}),e.jsx("button",{onClick:x,className:"bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 mt-2",children:"수정 완료"})]}):e.jsxs("div",{children:[s.discounts.map((r,p)=>e.jsx("div",{className:"mb-2",children:e.jsxs("span",{children:[r.quantity,"개 이상 구매 시 ",r.rate*100,"% 할인"]})},p)),e.jsx("button",{"data-testid":"modify-button",onClick:u,className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 mt-2",children:"수정"})]})})]})},ne=({products:s,coupons:t,onProductUpdate:n,onProductAdd:l,onCouponAdd:d})=>{const[i,c]=g.useState(!1),h=u=>{l(u),c(!1)};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"관리자 페이지"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 관리"}),e.jsx("button",{onClick:()=>c(!i),className:"bg-green-500 text-white px-4 py-2 rounded mb-4 hover:bg-green-600",children:i?"취소":"새 상품 추가"}),i&&e.jsx(te,{onCreate:h}),e.jsx("div",{className:"space-y-2",children:s.map((u,a)=>e.jsx(se,{index:a,product:u,onChange:n},u.id))})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"쿠폰 관리"}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx(K,{onCreate:d}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"현재 쿠폰 목록"}),e.jsx("div",{className:"space-y-2",children:t.map((u,a)=>e.jsx(H,{coupon:u,index:a},a))})]})]})]})]})]})},ae=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}],oe=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:"percentage",discountValue:10}],ce=()=>{const{products:s,updateProduct:t,addProduct:n}=ee(ae),{coupons:l,addCoupon:d}=X(oe),[i,c]=g.useState(!1),h=m=>{t(m)},u=m=>{n(m)},a=m=>{d(m)};return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("nav",{className:"bg-blue-600 text-white p-4",children:e.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"쇼핑몰 관리 시스템"}),e.jsx("button",{onClick:()=>c(!i),className:"bg-white text-blue-600 px-4 py-2 rounded hover:bg-blue-100",children:i?"장바구니 페이지로":"관리자 페이지로"})]})}),e.jsx("main",{className:"container mx-auto mt-6",children:i?e.jsx(ne,{products:s??[],coupons:l,onProductUpdate:h,onProductAdd:u,onCouponAdd:a}):e.jsx(Z,{products:s??[],coupons:l})})]})};U.createRoot(document.getElementById("root")).render(e.jsx(O.StrictMode,{children:e.jsx(ce,{})}));
